{"ast":null,"code":"import React,{useState,useEffect}from'react';import{io}from'socket.io-client';import axios from'axios';import{Container,Paper,TextField,Button,Box,Typography}from'@mui/material';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL='https://pipaan.com360degree.com/api/group_chat/add-group_chat';const SOCKET_URL='https://pipaan.com360degree.com/';const USER={id:197,token:'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjE5NywiaWF0IjoxNzQ2MzU4MzU2LCJleHAiOjE3NTE1NDIzNTYsInR5cGUiOiJyZWZyZXNoIn0.balsgBuA-1dotW-i-aOSgNuAHcul6JTyRqcJXnvsckQ',name:'User 197'};function App(){const[socket,setSocket]=useState(null);const[messages,setMessages]=useState([]);const[message,setMessage]=useState('');const[connected,setConnected]=useState(false);useEffect(()=>{const newSocket=io(SOCKET_URL,{auth:{token:USER.token}});newSocket.on('connect',()=>{setConnected(true);console.log('Connected to WebSocket with ID:',newSocket.id);// Join user's room\nnewSocket.emit('join',USER.id);});newSocket.on('joined',message=>{console.log('Room join confirmation:',message);});newSocket.on('disconnect',()=>{setConnected(false);console.log('Disconnected from WebSocket');});// Listen for messages\nnewSocket.on('receive-message',msg=>{console.log('Received message:',msg);setMessages(prev=>[...prev,{...msg,timestamp:msg.timestamp||new Date().toISOString()}]);});// Add error handler\nnewSocket.on('error',error=>{console.error('Socket error:',error);});// Add connect_error handler\nnewSocket.on('connect_error',error=>{console.error('Connection error:',error);});setSocket(newSocket);return()=>{newSocket.off('receive-message');newSocket.close();};},[]);const sendMessage=async()=>{if(!message.trim())return;const payload={message:message,reciever_id:199,// Sending to self\nmedia_url:[],is_group_chat:false};try{// Send message through API\nconst response=await axios.post(API_URL,payload,{headers:{'Token':USER.token,'Content-Type':'application/json'}});if(response.status===200){// The backend will handle the socket emission\nsetMessage('');}}catch(error){console.error('Error sending message:',error);}};return/*#__PURE__*/_jsxs(Container,{maxWidth:\"md\",sx:{py:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,align:\"center\",sx:{mb:4},children:\"Chat Test - Single User\"}),/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{p:3,height:'80vh',display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:USER.name}),/*#__PURE__*/_jsx(Box,{sx:{mb:2},children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:connected?'success.main':'error.main',children:[\"Status: \",connected?'Connected':'Disconnected']})}),/*#__PURE__*/_jsx(Paper,{elevation:1,sx:{flex:1,mb:2,p:2,overflow:'auto',backgroundColor:'#f5f5f5'},children:messages.map((msg,index)=>/*#__PURE__*/_jsx(Box,{sx:{textAlign:msg.sender_id===USER.id?'right':'left',mb:1},children:/*#__PURE__*/_jsxs(Typography,{sx:{display:'inline-block',backgroundColor:msg.sender_id===USER.id?'#e3f2fd':'#f5f5f5',padding:'8px 12px',borderRadius:'8px',maxWidth:'70%'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",color:\"textSecondary\",children:msg.sender_id===USER.id?'You':`User ${msg.sender_id}`}),/*#__PURE__*/_jsx(Typography,{children:msg.message}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",children:new Date(msg.timestamp).toLocaleTimeString()})]})},index))}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:1},children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,variant:\"outlined\",placeholder:\"Type your message...\",value:message,onChange:e=>setMessage(e.target.value),onKeyPress:e=>e.key==='Enter'&&sendMessage()}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:sendMessage,disabled:!connected,children:\"Send\"})]})]})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","io","axios","Container","Paper","TextField","Button","Box","Typography","jsx","_jsx","jsxs","_jsxs","API_URL","SOCKET_URL","USER","id","token","name","App","socket","setSocket","messages","setMessages","message","setMessage","connected","setConnected","newSocket","auth","on","console","log","emit","msg","prev","timestamp","Date","toISOString","error","off","close","sendMessage","trim","payload","reciever_id","media_url","is_group_chat","response","post","headers","status","maxWidth","sx","py","children","variant","gutterBottom","align","mb","elevation","p","height","display","flexDirection","color","flex","overflow","backgroundColor","map","index","textAlign","sender_id","padding","borderRadius","toLocaleTimeString","gap","fullWidth","placeholder","value","onChange","e","target","onKeyPress","key","onClick","disabled"],"sources":["/Users/sandip/Projects/New-Project/Socket-Test/chat-test/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { io } from 'socket.io-client';\nimport axios from 'axios';\nimport {\n  Container,\n  Paper,\n  TextField,\n  Button,\n  Box,\n  Typography,\n} from '@mui/material';\n\nconst API_URL = 'https://pipaan.com360degree.com/api/group_chat/add-group_chat';\nconst SOCKET_URL = 'https://pipaan.com360degree.com/';\n\nconst USER = {\n  id: 197,\n  token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjE5NywiaWF0IjoxNzQ2MzU4MzU2LCJleHAiOjE3NTE1NDIzNTYsInR5cGUiOiJyZWZyZXNoIn0.balsgBuA-1dotW-i-aOSgNuAHcul6JTyRqcJXnvsckQ',\n  name: 'User 197'\n};\n\nfunction App() {\n  const [socket, setSocket] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [message, setMessage] = useState('');\n  const [connected, setConnected] = useState(false);\n\n  useEffect(() => {\n    const newSocket = io(SOCKET_URL, {\n      auth: {\n        token: USER.token\n      }\n    });\n\n    newSocket.on('connect', () => {\n      setConnected(true);\n      console.log('Connected to WebSocket with ID:', newSocket.id);\n      \n      // Join user's room\n      newSocket.emit('join', USER.id);\n    });\n\n    newSocket.on('joined', (message) => {\n      console.log('Room join confirmation:', message);\n    });\n\n    newSocket.on('disconnect', () => {\n      setConnected(false);\n      console.log('Disconnected from WebSocket');\n    });\n\n    // Listen for messages\n    newSocket.on('receive-message', (msg) => {\n      console.log('Received message:', msg);\n      setMessages(prev => [...prev, {\n        ...msg,\n        timestamp: msg.timestamp || new Date().toISOString()\n      }]);\n    });\n\n    // Add error handler\n    newSocket.on('error', (error) => {\n      console.error('Socket error:', error);\n    });\n\n    // Add connect_error handler\n    newSocket.on('connect_error', (error) => {\n      console.error('Connection error:', error);\n    });\n\n    setSocket(newSocket);\n\n    return () => {\n      newSocket.off('receive-message');\n      newSocket.close();\n    };\n  }, []);\n\n  const sendMessage = async () => {\n    if (!message.trim()) return;\n\n    const payload = {\n      message: message,\n      reciever_id: 199, // Sending to self\n      media_url: [],\n      is_group_chat: false,\n    };\n\n    try {\n      // Send message through API\n      const response = await axios.post(API_URL, payload, {\n        headers: {\n          'Token': USER.token,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      if (response.status === 200) {\n        // The backend will handle the socket emission\n        setMessage('');\n      }\n    } catch (error) {\n      console.error('Error sending message:', error);\n    }\n  };\n\n  return (\n    <Container maxWidth=\"md\" sx={{ py: 4 }}>\n      <Typography variant=\"h4\" gutterBottom align=\"center\" sx={{ mb: 4 }}>\n        Chat Test - Single User\n      </Typography>\n      \n      <Paper elevation={3} sx={{ p: 3, height: '80vh', display: 'flex', flexDirection: 'column' }}>\n        <Typography variant=\"h5\" gutterBottom>\n          {USER.name}\n        </Typography>\n        \n        <Box sx={{ mb: 2 }}>\n          <Typography variant=\"body2\" color={connected ? 'success.main' : 'error.main'}>\n            Status: {connected ? 'Connected' : 'Disconnected'}\n          </Typography>\n        </Box>\n\n        <Paper \n          elevation={1} \n          sx={{ \n            flex: 1,\n            mb: 2, \n            p: 2, \n            overflow: 'auto',\n            backgroundColor: '#f5f5f5'\n          }}\n        >\n          {messages.map((msg, index) => (\n            <Box\n              key={index}\n              sx={{\n                textAlign: msg.sender_id === USER.id ? 'right' : 'left',\n                mb: 1\n              }}\n            >\n              <Typography\n                sx={{\n                  display: 'inline-block',\n                  backgroundColor: msg.sender_id === USER.id ? '#e3f2fd' : '#f5f5f5',\n                  padding: '8px 12px',\n                  borderRadius: '8px',\n                  maxWidth: '70%'\n                }}\n              >\n                <Typography variant=\"subtitle2\" color=\"textSecondary\">\n                  {msg.sender_id === USER.id ? 'You' : `User ${msg.sender_id}`}\n                </Typography>\n                <Typography>{msg.message}</Typography>\n                <Typography variant=\"caption\" color=\"textSecondary\">\n                  {new Date(msg.timestamp).toLocaleTimeString()}\n                </Typography>\n              </Typography>\n            </Box>\n          ))}\n        </Paper>\n\n        <Box sx={{ display: 'flex', gap: 1 }}>\n          <TextField\n            fullWidth\n            variant=\"outlined\"\n            placeholder=\"Type your message...\"\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}\n          />\n          <Button \n            variant=\"contained\" \n            onClick={sendMessage}\n            disabled={!connected}\n          >\n            Send\n          </Button>\n        </Box>\n      </Paper>\n    </Container>\n  );\n}\n\nexport default App; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}