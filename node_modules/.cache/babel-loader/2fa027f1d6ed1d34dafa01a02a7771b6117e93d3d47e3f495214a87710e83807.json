{"ast":null,"code":"import React,{useState,useEffect}from'react';import{io}from'socket.io-client';import axios from'axios';import{Container,Paper,TextField,Button,Box,Typography}from'@mui/material';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL='https://pipaan.com360degree.com/api/group_chat/add-group_chat';const SOCKET_URL='https://pipaan.com360degree.com/';const USER={id:197,token:'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjE5NywiaWF0IjoxNzQ2MzU4MzU2LCJleHAiOjE3NTE1NDIzNTYsInR5cGUiOiJyZWZyZXNoIn0.balsgBuA-1dotW-i-aOSgNuAHcul6JTyRqcJXnvsckQ',name:'User 197'};function App(){const[socket,setSocket]=useState(null);const[messages,setMessages]=useState([]);const[message,setMessage]=useState('');const[connected,setConnected]=useState(false);useEffect(()=>{const newSocket=io(SOCKET_URL,{auth:{token:USER.token}});// Register user\nnewSocket.emit('addUser',USER.id);newSocket.on('connect',()=>{setConnected(true);console.log('Connected to WebSocket');});newSocket.on('disconnect',()=>{setConnected(false);console.log('Disconnected from WebSocket');});// Listen for messages\nnewSocket.on('receiveMessage',msg=>{console.log('Received message:',msg);setMessages(prev=>[...prev,{...msg,timestamp:msg.timestamp||new Date().toISOString()}]);});setSocket(newSocket);return()=>{newSocket.off('receiveMessage');newSocket.close();};},[]);const sendMessage=async()=>{if(!message.trim())return;const payload={message:message,reciever_id:USER.id,// Sending to self\nmedia_url:[],is_group_chat:true};try{// Send message through API\nconst response=await axios.post(API_URL,payload,{headers:{'Token':USER.token,'Content-Type':'application/json'}});if(response.status===200){const newMessage={message:message,timestamp:new Date().toISOString(),senderId:USER.id,receiverId:USER.id};// Add message to messages immediately\nsetMessages(prev=>[...prev,newMessage]);// Emit the message through socket\nsocket===null||socket===void 0?void 0:socket.emit('sendMessage',newMessage);console.log('Message sent');setMessage('');}}catch(error){console.error('Error sending message:',error);}};return/*#__PURE__*/_jsxs(Container,{maxWidth:\"md\",sx:{py:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,align:\"center\",sx:{mb:4},children:\"Chat Test - Single User\"}),/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{p:3,height:'80vh',display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:USER.name}),/*#__PURE__*/_jsx(Box,{sx:{mb:2},children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:connected?'success.main':'error.main',children:[\"Status: \",connected?'Connected':'Disconnected']})}),/*#__PURE__*/_jsx(Paper,{elevation:1,sx:{flex:1,mb:2,p:2,overflow:'auto',backgroundColor:'#f5f5f5'},children:messages.map((msg,index)=>/*#__PURE__*/_jsx(Box,{sx:{textAlign:msg.senderId===USER.id?'right':'left',mb:1},children:/*#__PURE__*/_jsxs(Typography,{sx:{display:'inline-block',backgroundColor:msg.senderId===USER.id?'#e3f2fd':'#f5f5f5',padding:'8px 12px',borderRadius:'8px',maxWidth:'70%'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",color:\"textSecondary\",children:msg.senderId===USER.id?'You':`User ${msg.senderId}`}),/*#__PURE__*/_jsx(Typography,{children:msg.message}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",children:new Date(msg.timestamp).toLocaleTimeString()})]})},index))}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:1},children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,variant:\"outlined\",placeholder:\"Type your message...\",value:message,onChange:e=>setMessage(e.target.value),onKeyPress:e=>e.key==='Enter'&&sendMessage()}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:sendMessage,disabled:!connected,children:\"Send\"})]})]})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","io","axios","Container","Paper","TextField","Button","Box","Typography","jsx","_jsx","jsxs","_jsxs","API_URL","SOCKET_URL","USER","id","token","name","App","socket","setSocket","messages","setMessages","message","setMessage","connected","setConnected","newSocket","auth","emit","on","console","log","msg","prev","timestamp","Date","toISOString","off","close","sendMessage","trim","payload","reciever_id","media_url","is_group_chat","response","post","headers","status","newMessage","senderId","receiverId","error","maxWidth","sx","py","children","variant","gutterBottom","align","mb","elevation","p","height","display","flexDirection","color","flex","overflow","backgroundColor","map","index","textAlign","padding","borderRadius","toLocaleTimeString","gap","fullWidth","placeholder","value","onChange","e","target","onKeyPress","key","onClick","disabled"],"sources":["/Users/sandip/Projects/New-Project/Socket-Test/chat-test/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { io } from 'socket.io-client';\nimport axios from 'axios';\nimport {\n  Container,\n  Paper,\n  TextField,\n  Button,\n  Box,\n  Typography,\n} from '@mui/material';\n\nconst API_URL = 'https://pipaan.com360degree.com/api/group_chat/add-group_chat';\nconst SOCKET_URL = 'https://pipaan.com360degree.com/';\n\nconst USER = {\n  id: 197,\n  token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjE5NywiaWF0IjoxNzQ2MzU4MzU2LCJleHAiOjE3NTE1NDIzNTYsInR5cGUiOiJyZWZyZXNoIn0.balsgBuA-1dotW-i-aOSgNuAHcul6JTyRqcJXnvsckQ',\n  name: 'User 197'\n};\n\nfunction App() {\n  const [socket, setSocket] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [message, setMessage] = useState('');\n  const [connected, setConnected] = useState(false);\n\n  useEffect(() => {\n    const newSocket = io(SOCKET_URL, {\n      auth: {\n        token: USER.token\n      }\n    });\n\n    // Register user\n    newSocket.emit('addUser', USER.id);\n\n    newSocket.on('connect', () => {\n      setConnected(true);\n      console.log('Connected to WebSocket');\n    });\n\n    newSocket.on('disconnect', () => {\n      setConnected(false);\n      console.log('Disconnected from WebSocket');\n    });\n\n    // Listen for messages\n    newSocket.on('receiveMessage', (msg) => {\n      console.log('Received message:', msg);\n      setMessages(prev => [...prev, {\n        ...msg,\n        timestamp: msg.timestamp || new Date().toISOString()\n      }]);\n    });\n\n    setSocket(newSocket);\n\n    return () => {\n      newSocket.off('receiveMessage');\n      newSocket.close();\n    };\n  }, []);\n\n  const sendMessage = async () => {\n    if (!message.trim()) return;\n\n    const payload = {\n      message: message,\n      reciever_id: USER.id, // Sending to self\n      media_url: [],\n      is_group_chat: true\n    };\n\n    try {\n      // Send message through API\n      const response = await axios.post(API_URL, payload, {\n        headers: {\n          'Token': USER.token,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      if (response.status === 200) {\n        const newMessage = {\n          message: message,\n          timestamp: new Date().toISOString(),\n          senderId: USER.id,\n          receiverId: USER.id\n        };\n\n        // Add message to messages immediately\n        setMessages(prev => [...prev, newMessage]);\n\n        // Emit the message through socket\n        socket?.emit('sendMessage', newMessage);\n        \n        console.log('Message sent');\n        setMessage('');\n      }\n    } catch (error) {\n      console.error('Error sending message:', error);\n    }\n  };\n\n  return (\n    <Container maxWidth=\"md\" sx={{ py: 4 }}>\n      <Typography variant=\"h4\" gutterBottom align=\"center\" sx={{ mb: 4 }}>\n        Chat Test - Single User\n      </Typography>\n      \n      <Paper elevation={3} sx={{ p: 3, height: '80vh', display: 'flex', flexDirection: 'column' }}>\n        <Typography variant=\"h5\" gutterBottom>\n          {USER.name}\n        </Typography>\n        \n        <Box sx={{ mb: 2 }}>\n          <Typography variant=\"body2\" color={connected ? 'success.main' : 'error.main'}>\n            Status: {connected ? 'Connected' : 'Disconnected'}\n          </Typography>\n        </Box>\n\n        <Paper \n          elevation={1} \n          sx={{ \n            flex: 1,\n            mb: 2, \n            p: 2, \n            overflow: 'auto',\n            backgroundColor: '#f5f5f5'\n          }}\n        >\n          {messages.map((msg, index) => (\n            <Box\n              key={index}\n              sx={{\n                textAlign: msg.senderId === USER.id ? 'right' : 'left',\n                mb: 1\n              }}\n            >\n              <Typography\n                sx={{\n                  display: 'inline-block',\n                  backgroundColor: msg.senderId === USER.id ? '#e3f2fd' : '#f5f5f5',\n                  padding: '8px 12px',\n                  borderRadius: '8px',\n                  maxWidth: '70%'\n                }}\n              >\n                <Typography variant=\"subtitle2\" color=\"textSecondary\">\n                  {msg.senderId === USER.id ? 'You' : `User ${msg.senderId}`}\n                </Typography>\n                <Typography>{msg.message}</Typography>\n                <Typography variant=\"caption\" color=\"textSecondary\">\n                  {new Date(msg.timestamp).toLocaleTimeString()}\n                </Typography>\n              </Typography>\n            </Box>\n          ))}\n        </Paper>\n\n        <Box sx={{ display: 'flex', gap: 1 }}>\n          <TextField\n            fullWidth\n            variant=\"outlined\"\n            placeholder=\"Type your message...\"\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}\n          />\n          <Button \n            variant=\"contained\" \n            onClick={sendMessage}\n            disabled={!connected}\n          >\n            Send\n          </Button>\n        </Box>\n      </Paper>\n    </Container>\n  );\n}\n\nexport default App; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}